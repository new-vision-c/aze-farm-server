components:
  parameters:
    limit:
      description: Number of items per page
      in: query
      name: limit
      required: false
      schema:
        default: 10
        maximum: 100
        minimum: 1
        type: integer
    oauthCode:
      description: The authorization code returned by the OAuth provider
      in: query
      name: code
      required: false
      schema:
        type: string
    oauthError:
      description: Error code if OAuth flow failed
      in: query
      name: error
      required: false
      schema:
        type: string
    oauthProvider:
      description: The OAuth provider to authenticate with
      example: google
      in: path
      name: provider
      required: true
      schema:
        enum:
        - google
        - github
        - facebook
        - instagram
        - twitter
        - linkedin
        - telegram
        type: string
    oauthState:
      description: The state parameter for CSRF protection
      in: query
      name: state
      required: false
      schema:
        type: string
    order:
      description: Sort order (asc or desc)
      in: query
      name: order
      required: false
      schema:
        default: desc
        enum:
        - asc
        - desc
        type: string
    page:
      description: Page number for pagination
      in: query
      name: page
      required: false
      schema:
        default: 1
        minimum: 1
        type: integer
    path_product_id:
      description: ID du produit
      example: 507f1f77bcf86cd799439011
      in: path
      name: id
      required: true
      schema:
        format: mongoId
        type: string
    query_category:
      description: Filtrer par catégorie de produit
      example: légumes
      in: query
      name: category
      schema:
        type: string
    query_lat:
      description: Latitude de l'utilisateur pour le calcul de distance
      example: 48.8566
      in: query
      name: lat
      schema:
        maximum: 90
        minimum: -90
        type: number
    query_limit:
      description: Nombre maximum de résultats à retourner
      example: 10
      in: query
      name: limit
      schema:
        default: 10
        maximum: 100
        minimum: 1
        type: integer
    query_lng:
      description: Longitude de l'utilisateur pour le calcul de distance
      example: 2.3522
      in: query
      name: lng
      schema:
        maximum: 180
        minimum: -180
        type: number
    query_page:
      description: Numéro de page pour la pagination
      example: 1
      in: query
      name: page
      schema:
        default: 1
        minimum: 1
        type: integer
    query_product:
      description: Filtrer par nom de produit (recherche partielle)
      example: tomate
      in: query
      name: product
      schema:
        type: string
    redirectUri:
      description: The URI to redirect to after successful authentication
      example: https://yourapp.com/auth/callback
      in: query
      name: redirect_uri
      required: false
      schema:
        format: uri
        type: string
    sortBy:
      description: Field to sort by
      in: query
      name: sortBy
      required: false
      schema:
        default: createdAt
        type: string
    userId:
      description: User ID (UUID)
      in: path
      name: user_id
      required: true
      schema:
        example: 123e4567-e89b-12d3-a456-426614174000
        format: uuid
        type: string
  responses:
    ErrorResponse:
      properties:
        error:
          properties:
            code:
              example: VALIDATION_ERROR
              type: string
            details:
              items:
                properties:
                  field:
                    example: email
                    type: string
                  message:
                    example: Email is required
                    type: string
                type: object
              type: array
            message:
              example: Validation failed
              type: string
          type: object
        success:
          example: false
          type: boolean
      type: object
    Pagination:
      properties:
        limit:
          example: 10
          type: integer
        page:
          example: 1
          type: integer
        total:
          example: 100
          type: integer
        totalPages:
          example: 10
          type: integer
      type: object
    SuccessResponse:
      properties:
        data:
          description: Response data
          type: object
        message:
          example: Operation completed successfully
          type: string
        success:
          example: true
          type: boolean
      type: object
  schemas:
    ChangePassword:
      properties:
        confirmNewPassword:
          example: NewSecurePassword123!
          format: password
          type: string
        currentPassword:
          example: CurrentPassword123!
          format: password
          type: string
        newPassword:
          example: NewSecurePassword123!
          format: password
          minLength: 8
          type: string
      required:
      - currentPassword
      - newPassword
      - confirmNewPassword
      type: object
    ForgotPassword:
      properties:
        email:
          example: user@example.com
          format: email
          type: string
      required:
      - email
      type: object
    OAuthError:
      properties:
        error:
          description: Error code
          example: invalid_grant
          type: string
        error_description:
          description: Human-readable error description
          example: The provided authorization grant is invalid, expired, revoked,
            or does not match the redirection URI used in the authorization request.
          type: string
        error_uri:
          description: A URI identifying the error
          example: https://tools.ietf.org/html/rfc6749#section-5.2
          format: uri
          type: string
      type: object
    ProductSearchQuery:
      properties:
        category:
          description: Filtrer par catégorie
          example: légumes
          type: string
        lat:
          description: Latitude de l'utilisateur
          example: 48.8566
          maximum: 90
          minimum: -90
          type: number
        limit:
          default: 10
          description: Nombre maximum de résultats
          example: 10
          maximum: 100
          minimum: 1
          type: integer
        lng:
          description: Longitude de l'utilisateur
          example: 2.3522
          maximum: 180
          minimum: -180
          type: number
        page:
          default: 1
          description: Numéro de page pour la pagination
          example: 1
          minimum: 1
          type: integer
        product:
          description: Filtrer par nom de produit
          example: tomate
          type: string
      type: object
    ProductWithDistance:
      properties:
        category:
          description: Catégorie du produit
          example: légumes
          type: string
        description:
          description: Description détaillée du produit
          example: Tomates cerises bio, cultivées avec amour
          type: string
        distance:
          description: Distance en km depuis la position de l'utilisateur (présent
            uniquement si localisation fournie)
          example: 2.3
          format: float
          type: number
        farm:
          properties:
            address:
              description: Adresse de la ferme
              example: 123 Route de la Ferme, 75000 Paris
              type: string
            geoLocation:
              properties:
                latitude:
                  description: Latitude de la ferme
                  example: 48.8566
                  format: float
                  type: number
                longitude:
                  description: Longitude de la ferme
                  example: 2.3522
                  format: float
                  type: number
              type: object
            id:
              description: ID de la ferme
              example: 507f1f77bcf86cd799439012
              format: mongoId
              type: string
            name:
              description: Nom de la ferme
              example: Ferme du Soleil
              type: string
            ratingAvg:
              description: Note moyenne de la ferme
              example: 4.5
              format: float
              type: number
            ratingCount:
              description: Nombre d'avis sur la ferme
              example: 128
              type: integer
          type: object
        id:
          description: ID unique du produit
          example: 507f1f77bcf86cd799439011
          format: mongoId
          type: string
        images:
          description: URLs des images du produit
          example:
          - https://example.com/tomates1.jpg
          - https://example.com/tomates2.jpg
          items:
            format: uri
            type: string
          type: array
        isAvailable:
          description: Indique si le produit est disponible
          example: true
          type: boolean
        name:
          description: Nom du produit
          example: Tomates cerises
          type: string
        price:
          description: Prix du produit
          example: 4.5
          format: float
          type: number
        seasonality:
          description: Mois de saisonnalité (1-12)
          example:
          - 6
          - 7
          - 8
          - 9
          items:
            type: integer
          type: array
        stock:
          description: Quantité disponible en stock
          example: 25
          type: integer
        unit:
          description: Unité de vente
          example: kg
          type: string
      type: object
    ResendOTP:
      properties:
        email:
          example: user@example.com
          format: email
          type: string
      required:
      - sessionToken
      type: object
    ResetPassword:
      properties:
        confirmPassword:
          example: NewSecurePassword123!
          format: password
          type: string
        password:
          example: NewSecurePassword123!
          format: password
          minLength: 8
          type: string
      required:
      - password
      - confirmPassword
      type: object
    UserLogin:
      properties:
        email:
          example: user@example.com
          format: email
          type: string
        password:
          example: SecurePassword123!
          format: password
          type: string
      required:
      - email
      - password
      type: object
    UserRegister:
      properties:
        email:
          example: user@example.com
          format: email
          type: string
        fullname:
          example: John Doe
          type: string
        password:
          example: SecurePassword123!
          format: password
          minLength: 8
          type: string
        profile:
          description: Profile picture (optional)
          format: binary
          type: string
      required:
      - email
      - password
      - fullname
      type: object
    VerifyOTP:
      properties:
        otp:
          example: '123456'
          type: string
        sessionToken:
          example: user@example.com
          type: string
      required:
      - sessionToken
      - otp
      type: object
    properties:
      email:
        description: User's email address
        example: user@example.com
        format: email
        type: string
      password:
        description: User's password
        example: your-secure-password
        format: password
        type: string
      rememberMe:
        default: false
        description: Whether to issue a long-lived refresh token
        type: boolean
    required:
    - email
    - password
    type: object
  securitySchemes:
    OAuth2:
      description: OAuth2 authentication
      flows:
        authorizationCode:
          authorizationUrl: https://accounts.google.com/o/oauth2/v2/auth
          scopes:
            email: Access to email address
            openid: OpenID authentication
            profile: Access to profile information
          tokenUrl: https://oauth2.googleapis.com/token
      type: oauth2
    bearerAuth:
      bearerFormat: JWT
      description: JWT obtained after authentication
      scheme: bearer
      type: http
info:
  contact:
    email: support@azefarm.com
    name: Équipe Support AZE FARM
    url: https://azefarm.com/support
  description: 'API complète pour la gestion des produits agricoles, fermes et commandes
    avec recherche géolocalisée. Fonctionnalités principales: Recherche de produits
    avec filtres et localisation, Géolocalisation avec tri par distance, Gestion des
    fermes, Authentification JWT et OAuth2.0, Gestion des commandes.'
  license:
    name: Propriétaire
    url: https://azefarm.com/terms
  title: AZE FARM API Documentation
  version: 1.0.0
openapi: 3.0.3
paths:
  /_csp-reports:
    post:
      description: Endpoint for receiving Content Security Policy violation reports
      requestBody:
        content:
          application/csp-report:
            schema:
              properties:
                csp-report:
                  properties:
                    blocked-uri:
                      example: https://malicious.com/script.js
                      type: string
                    document-uri:
                      example: https://example.com/page
                      type: string
                    original-policy:
                      example: default-src 'self'; script-src 'self'
                      type: string
                    referrer:
                      example: https://example.com/
                      type: string
                    violated-directive:
                      example: script-src 'self'
                      type: string
                  type: object
              type: object
        required: true
      responses:
        '204':
          description: Report received successfully
        '400':
          $ref: ../components/responses/BadRequest.yaml
      summary: Content Security Policy Reports
      tags:
      - System
  /auth/change-password:
    post:
      description: 'Change le mot de passe d''un utilisateur authentifié sans oublier
        son mot de passe.

        Nécessite le mot de passe actuel pour sécurité (anti-CSRF).

        Le nouveau mot de passe doit être différent de l''ancien et respecter les
        critères de sécurité.


        **Prérequis :** Utilisateur doit être authentifié (token valide)

        '
      operationId: changePassword
      requestBody:
        content:
          application/json:
            schema:
              properties:
                currentPassword:
                  description: Mot de passe actuel pour vérification d'identité
                  example: CurrentPass123!
                  format: password
                  type: string
                password:
                  description: Nouveau mot de passe (minimum 8 caractères)
                  example: NewSecurePass456!
                  format: password
                  minLength: 8
                  type: string
                passwordConfirm:
                  description: Confirmation du nouveau mot de passe (doit être identique)
                  example: NewSecurePass456!
                  format: password
                  type: string
              required:
              - currentPassword
              - password
              - passwordConfirm
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Mot de passe changé avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Mot de passe changé avec succès. L'utilisateur devra se reconnecter
            avec le nouveau mot de passe.
        '400':
          content:
            application/json:
              schema:
                properties:
                  error:
                    properties:
                      code:
                        example: INVALID_CURRENT_PASSWORD
                        type: string
                      message:
                        example: Le mot de passe actuel est incorrect
                        type: string
                    type: object
                  success:
                    example: false
                    type: boolean
                type: object
          description: Mot de passe actuel incorrect ou nouveau mot de passe invalide
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '422':
          $ref: ../components/responses/common.yaml#/ValidationError
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Changer le mot de passe
      tags:
      - Authentication
  /auth/forgot-password:
    post:
      description: 'Envoie un email contenant un lien de réinitialisation du mot de
        passe à l''utilisateur.

        Le lien expire après 1 heure pour des raisons de sécurité.

        Utilisé quand l''utilisateur oublie son mot de passe.


        **Sécurité :** Ne révèle pas si l''email existe ou non dans la base de données.

        '
      operationId: forgotPassword
      requestBody:
        content:
          application/json:
            schema:
              properties:
                email:
                  description: Adresse email associée au compte
                  example: john.doe@example.com
                  format: email
                  type: string
              required:
              - email
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Email de réinitialisation envoyé avec succès. Veuillez
                      vérifier votre email.
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Email de réinitialisation envoyé avec succès (même si l'email
            n'existe pas)
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Demander la réinitialisation du mot de passe
      tags:
      - Authentication
  /auth/login:
    post:
      description: 'Authentifie un utilisateur avec son email et mot de passe.

        Retourne un JWT access token et un refresh token pour les requêtes authentifiées.

        L''utilisateur doit avoir un compte actif, vérifié et non supprimé.


        **Tokens retournés :**

        - `accessToken` : JWT valide pendant 15 minutes pour les requêtes authentifiées

        - `refreshToken` : Token valide pendant 7 jours pour obtenir un nouveau access
        token

        '
      operationId: loginUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../components/schemas/LoginRequest.yaml
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/AuthResponse.yaml
                  message:
                    example: Connexion réussie
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Connexion réussie. Les tokens d'authentification sont retournés
            dans la réponse et en cookies.
        '400':
          content:
            application/json:
              schema:
                properties:
                  error:
                    properties:
                      code:
                        example: INVALID_CREDENTIALS
                        type: string
                      message:
                        example: Email ou mot de passe incorrect
                        type: string
                    type: object
                  success:
                    example: false
                    type: boolean
                type: object
          description: Identifiants invalides, compte non vérifié ou inactif
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Connexion utilisateur
      tags:
      - Authentication
  /auth/logout:
    post:
      description: 'Déconnecte l''utilisateur en invalidant son token actuel.

        Efface les sessions, cookies et tokens d''authentification.

        L''utilisateur ne peut plus accéder aux ressources protégées sans se reconnecter.

        '
      operationId: logoutUser
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Déconnexion réussie
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Déconnexion réussie
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Déconnexion utilisateur
      tags:
      - Authentication
  /auth/me/profile:
    get:
      description: 'Récupère les informations du profil de l''utilisateur authentifié.

        Retourne les données personnelles non sensibles de l''utilisateur.


        **Prérequis :** Utilisateur doit être authentifié avec un token valide.

        '
      operationId: getUserProfile
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    properties:
                      avatar_url:
                        example: https://example.com/avatars/john.jpg
                        format: uri
                        nullable: true
                        type: string
                      created_at:
                        example: '2024-01-15T10:30:00Z'
                        format: date-time
                        type: string
                      email:
                        example: john.doe@example.com
                        format: email
                        type: string
                      email_verified_at:
                        example: '2024-01-15T11:00:00Z'
                        format: date-time
                        nullable: true
                        type: string
                      fullname:
                        example: John Doe
                        type: string
                      is_active:
                        example: true
                        type: boolean
                      is_verified:
                        example: true
                        type: boolean
                      last_login_at:
                        example: '2024-01-20T09:15:00Z'
                        format: date-time
                        nullable: true
                        type: string
                      role:
                        enum:
                        - CONSUMER
                        - ADMIN
                        - FARMER
                        example: CONSUMER
                        type: string
                      updated_at:
                        example: '2024-01-20T14:22:00Z'
                        format: date-time
                        type: string
                      user_id:
                        example: 507f1f77bcf86cd799439011
                        type: string
                    type: object
                  message:
                    example: Profil récupéré avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Profil utilisateur récupéré avec succès
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '404':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Utilisateur non trouvé
                    type: string
                  success:
                    example: false
                    type: boolean
                type: object
          description: Utilisateur non trouvé
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Récupérer le profil utilisateur
      tags:
      - Authentication
    put:
      description: 'Met à jour les informations du profil de l''utilisateur authentifié.

        Permet de modifier le nom complet et/ou l''URL de l''avatar.


        **Champs modifiables :**

        - `fullname` : Nom complet de l''utilisateur (optionnel)

        - `avatar` : Fichier image pour l''avatar (optionnel, multipart/form-data)


        **Prérequis :** Utilisateur doit être authentifié avec un token valide.


        **Upload d''avatar :** Le fichier sera uploadé sur Cloudinary et l''URL sera
        automatiquement générée. L''ancien avatar sera supprimé de Cloudinary.


        **Format supporté :** Images (JPEG, PNG, WebP) - Maximum 5MB

        '
      operationId: updateUserProfile
      requestBody:
        content:
          multipart/form-data:
            schema:
              properties:
                avatar:
                  description: Fichier image pour l'avatar (JPEG, PNG, WebP, max 5MB)
                  example: binary-avatar-data
                  format: binary
                  type: string
                fullname:
                  description: Nom complet de l'utilisateur (optionnel)
                  example: John Smith
                  maxLength: 50
                  minLength: 2
                  type: string
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    properties:
                      avatar_url:
                        example: https://example.com/avatars/john-new.jpg
                        format: uri
                        nullable: true
                        type: string
                      created_at:
                        example: '2024-01-15T10:30:00Z'
                        format: date-time
                        type: string
                      email:
                        example: john.doe@example.com
                        format: email
                        type: string
                      fullname:
                        example: John Smith
                        type: string
                      is_active:
                        example: true
                        type: boolean
                      is_verified:
                        example: true
                        type: boolean
                      role:
                        enum:
                        - CONSUMER
                        - ADMIN
                        - FARMER
                        example: CONSUMER
                        type: string
                      updated_at:
                        example: '2024-01-20T14:22:00Z'
                        format: date-time
                        type: string
                      user_id:
                        example: 507f1f77bcf86cd799439011
                        type: string
                    type: object
                  message:
                    example: Profil mis à jour avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Profil mis à jour avec succès
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '404':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Utilisateur non trouvé
                    type: string
                  success:
                    example: false
                    type: boolean
                type: object
          description: Utilisateur non trouvé
        '422':
          $ref: ../components/responses/common.yaml#/ValidationError
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Mettre à jour le profil utilisateur
      tags:
      - Authentication
  /auth/register:
    post:
      description: 'Crée un nouveau compte utilisateur avec email et profil optionnel.

        Envoie un OTP (One-Time Password) à l''adresse email fournie pour la vérification
        du compte.

        La photo de profil est optionnelle et doit être une image au format JPEG ou
        PNG (max 5MB).


        **Étapes suivantes :**

        1. L''utilisateur reçoit un code OTP par email

        2. Appeler `/auth/verify-otp` pour vérifier le compte

        3. Une fois vérifié, l''utilisateur peut se connecter normalement

        '
      operationId: RegisterUser
      requestBody:
        content:
          multipart/form-data:
            schema:
              properties:
                email:
                  description: Adresse email unique de l'utilisateur (sera l'identifiant
                    de connexion)
                  example: john.doe@example.com
                  format: email
                  type: string
                fullname:
                  description: Nom complet de l'utilisateur
                  example: John Doe
                  maxLength: 50
                  minLength: 2
                  type: string
                password:
                  description: Mot de passe sécurisé (minimum 6 caractères, doit contenir
                    majuscules, minuscules et caractères spéciaux)
                  example: SecurePass123!
                  format: password
                  minLength: 6
                  type: string
              required:
              - email
              - password
              - fullname
              type: object
        required: true
      responses:
        '201':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/AuthResponse.yaml
                  message:
                    example: Compte créé avec succès. Veuillez vérifier votre email
                      pour le code de vérification.
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Compte créé avec succès. Un code OTP a été envoyé à l'email
            de l'utilisateur.
        '400':
          content:
            application/json:
              schema:
                properties:
                  error:
                    properties:
                      code:
                        example: DUPLICATE_EMAIL
                        type: string
                      message:
                        example: Un compte avec cet email existe déjà
                        type: string
                    type: object
                  success:
                    example: false
                    type: boolean
                type: object
          description: Données invalides ou email déjà existant
        '422':
          $ref: ../components/responses/common.yaml#/ValidationError
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Créer un nouveau compte utilisateur
      tags:
      - Authentication
  /auth/resend-otp:
    post:
      description: 'Renvoie un nouveau code OTP à l''adresse email de l''utilisateur.

        Utilisé si l''utilisateur n''a pas reçu le premier code ou s''il a expiré.


        **Limite de taux :** Délai minimum de 5 minutes entre les renvois.

        '
      operationId: resendOtp
      requestBody:
        content:
          application/json:
            schema:
              properties:
                email:
                  description: Adresse email du compte utilisateur
                  example: john.doe@example.com
                  format: email
                  type: string
              required:
              - email
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Code OTP renvoyé avec succès. Veuillez vérifier votre
                      email.
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Nouveau code OTP envoyé avec succès à l'email
        '400':
          content:
            application/json:
              schema:
                properties:
                  error:
                    properties:
                      code:
                        example: RATE_LIMIT_EXCEEDED
                        type: string
                      message:
                        example: Veuillez attendre 5 minutes avant de renvoyer un
                          autre code
                        type: string
                    type: object
                  success:
                    example: false
                    type: boolean
                type: object
          description: Trop de tentatives ou email introuvable
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Renvoyer le code OTP
      tags:
      - Authentication
  /auth/reset-password/{resetToken}:
    post:
      description: 'Réinitialise le mot de passe à l''aide du token reçu par email.

        Le token doit être valide et ne pas être expiré (validité 1 heure).

        Le nouveau mot de passe doit respecter les critères de sécurité et être différent
        de l''ancien.


        **Validations :**

        - Token valide et non expiré

        - Mot de passe minimum 8 caractères

        - Confirmation du mot de passe identique

        '
      operationId: resetPassword
      parameters:
      - description: Token de réinitialisation reçu dans l'email (expire après 1 heure)
        example: a1b2c3d4e5f67890abcdef1234567890
        in: path
        name: resetToken
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              properties:
                password:
                  description: Nouveau mot de passe sécurisé
                  example: NewSecurePass456!
                  format: password
                  minLength: 8
                  type: string
                passwordConfirm:
                  description: Confirmation du nouveau mot de passe (doit être identique)
                  example: NewSecurePass456!
                  format: password
                  type: string
              required:
              - password
              - passwordConfirm
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Mot de passe réinitialisé avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Mot de passe réinitialisé avec succès. L'utilisateur peut se
            connecter avec le nouveau mot de passe.
        '400':
          content:
            application/json:
              schema:
                properties:
                  error:
                    properties:
                      code:
                        example: INVALID_RESET_TOKEN
                        type: string
                      message:
                        example: Lien de réinitialisation invalide ou expiré
                        type: string
                    type: object
                  success:
                    example: false
                    type: boolean
                type: object
          description: Token invalide, expiré ou mots de passe invalides
        '422':
          $ref: ../components/responses/common.yaml#/ValidationError
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Réinitialiser le mot de passe
      tags:
      - Authentication
  /auth/verify-otp:
    post:
      description: 'Valide le compte utilisateur en utilisant le code OTP à 6 chiffres
        reçu par email.

        Cette étape est obligatoire après l''enregistrement.

        Après vérification réussie, l''utilisateur a accès à toutes les fonctionnalités.


        **Délai d''expiration :** Le code OTP expire après 15 minutes.

        '
      operationId: verifyAccount
      requestBody:
        content:
          application/json:
            schema:
              properties:
                otp:
                  description: Code OTP à 6 chiffres reçu dans l'email de vérification
                  example: '123456'
                  pattern: ^\d{6}$
                  type: string
              required:
              - otp
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/User.yaml
                  message:
                    example: Compte vérifié avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Compte vérifié avec succès. L'utilisateur peut maintenant accéder
            à tous les services.
        '400':
          content:
            application/json:
              schema:
                properties:
                  error:
                    properties:
                      code:
                        example: INVALID_OTP
                        type: string
                      message:
                        example: Code OTP invalide ou expiré
                        type: string
                    type: object
                  success:
                    example: false
                    type: boolean
                type: object
          description: Code OTP invalide, expiré ou utilisateur déjà vérifié
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Vérifier le compte avec OTP
      tags:
      - Authentication
  /csrf-token:
    get:
      description: Get a CSRF token for form submissions
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  csrfToken:
                    example: abcd1234efgh5678
                    type: string
                type: object
          description: CSRF token generated successfully
      summary: Get CSRF token
      tags:
      - System
  /health:
    $ref: ./health/health.yaml
  /items:
    $ref: ./items/items.yaml
  /items/{id}:
    $ref: ./items/items.yaml#/items/{id}
  /oauth/token:
    post:
      description: 'Exchanges an OAuth authorization code for an access token.

        This is typically used by the frontend to complete the OAuth flow.

        '
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../components/schemas/OAuthTokenRequest.yaml
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: ../components/schemas/OAuthTokenResponse.yaml
          description: Successful token exchange
        '400':
          $ref: ../components/responses/BadRequest.yaml
        '401':
          $ref: ../components/responses/Unauthorized.yaml
        '500':
          $ref: ../components/responses/ServerError.yaml
      summary: Exchange OAuth code for access token
      tags:
      - OAuth
  /oauth/{provider}:
    get:
      description: 'Redirige vers la page de connexion du fournisseur OAuth (Google,
        Apple, etc.).

        Paramètre `redirectUri` pour retourner après authentification.


        **Fournisseurs supportés :** google, apple

        '
      operationId: initiateOAuth
      parameters:
      - $ref: ../components/parameters/oauthProvider.yaml
      - description: URL de retour après authentification réussie (doit correspondre
          à la configuration du serveur)
        example: https://app.example.com/auth/callback
        in: query
        name: redirectUri
        required: false
        schema:
          format: uri
          type: string
      responses:
        '302':
          description: Redirection vers la page de connexion du fournisseur OAuth
        '400':
          $ref: ../components/responses/common.yaml#/BadRequest
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Initier l'authentification OAuth
      tags:
      - OAuth
  /oauth/{provider}/callback:
    get:
      description: 'URL de callback qui gère la réponse du fournisseur OAuth.

        Appelée automatiquement par le fournisseur OAuth après authentification.

        Crée ou met à jour le profil utilisateur et retourne les tokens.


        **Ne pas appeler manuellement** - c''est un callback système.

        '
      operationId: handleOAuthCallback
      parameters:
      - $ref: ../components/parameters/oauthProvider.yaml
      - description: Code d'autorisation reçu du fournisseur OAuth
        in: query
        name: code
        required: true
        schema:
          example: 4/0AY0e-g7xAb...
          type: string
      - description: État CSRF pour validation de sécurité
        in: query
        name: state
        required: true
        schema:
          example: a1b2c3d4e5f6g7h8
          type: string
      responses:
        '302':
          description: Redirection vers l'URL de succès avec tokens en paramètres
        '400':
          $ref: ../components/responses/common.yaml#/BadRequest
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Callback OAuth
      tags:
      - OAuth
  /products/categories:
    get:
      description: Récupère la liste de toutes les catégories de produits disponibles
      responses:
        200:
          content:
            application/json:
              schema:
                properties:
                  data:
                    example:
                    - légumes
                    - fruits
                    - céréales
                    - produits laitiers
                    items:
                      type: string
                    type: array
                  message:
                    example: Catégories récupérées avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Catégories récupérées avec succès
        500:
          $ref: ../components/responses/internal_server_error.yaml
      summary: Lister les catégories de produits
      tags:
      - Products
  /products/search:
    get:
      description: 'Recherche des produits disponibles avec filtres avancés et tri
        par proximité géographique.

        Les produits sont classés par distance de l''utilisateur si les coordonnées
        sont fournies,

        sinon par note de la ferme.

        '
      parameters:
      - $ref: ../components/parameters/query_limit.yaml
      - $ref: ../components/parameters/query_page.yaml
      - $ref: ../components/parameters/query_category.yaml
      - $ref: ../components/parameters/query_product.yaml
      - $ref: ../components/parameters/query_lat.yaml
      - $ref: ../components/parameters/query_lng.yaml
      responses:
        200:
          content:
            application/json:
              schema:
                properties:
                  data:
                    properties:
                      currentPage:
                        example: 1
                        type: integer
                      items:
                        items:
                          $ref: ../components/schemas/product.yaml#/ProductWithDistance
                        type: array
                      totalItems:
                        example: 25
                        type: integer
                      totalPages:
                        example: 3
                        type: integer
                    type: object
                  message:
                    example: Produits récupérés avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Produits récupérés avec succès
        400:
          $ref: ../components/responses/bad_request.yaml
        500:
          $ref: ../components/responses/internal_server_error.yaml
      summary: Rechercher des produits avec filtres et localisation
      tags:
      - Products
  /products/{id}:
    get:
      description: Récupère les informations complètes d'un produit spécifique incluant
        les détails de la ferme
      parameters:
      - $ref: ../components/parameters/path_product_id.yaml
      responses:
        200:
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/product.yaml#/ProductWithDistance
                  message:
                    example: Produit récupéré avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Produit récupéré avec succès
        400:
          $ref: ../components/responses/bad_request.yaml
        404:
          $ref: ../components/responses/not_found.yaml
        500:
          $ref: ../components/responses/internal_server_error.yaml
      summary: Obtenir les détails d'un produit
      tags:
      - Products
  /users:
    get:
      description: 'Récupère une liste paginée de tous les utilisateurs enregistrés.

        Permet le filtrage, la recherche et le tri.

        Résultats limités à 100 utilisateurs par page maximum.


        **Cas d''usage :**

        - Afficher la liste des utilisateurs disponibles

        - Rechercher un utilisateur spécifique

        - Exporter ou analyser les données utilisateurs

        '
      operationId: listUsers
      parameters:
      - $ref: ../components/parameters/common.yaml#/page
      - $ref: ../components/parameters/common.yaml#/limit
      - description: Terme de recherche pour filtrer par email, nom ou prénom (insensible
          à la casse)
        example: john
        in: query
        name: search
        required: false
        schema:
          maxLength: 100
          minLength: 2
          type: string
      - description: Filtrer par rôle utilisateur
        example: admin
        in: query
        name: role
        required: false
        schema:
          enum:
          - user
          - admin
          - moderator
          type: string
      - description: Filtrer par statut actif/inactif
        example: 'true'
        in: query
        name: isActive
        required: false
        schema:
          type: boolean
      - description: Filtrer par statut vérifié/non vérifié
        example: 'true'
        in: query
        name: isVerified
        required: false
        schema:
          type: boolean
      - description: Champ pour le tri
        example: createdAt
        in: query
        name: sortBy
        required: false
        schema:
          enum:
          - createdAt
          - email
          - firstName
          - lastLogin
          type: string
      - description: Ordre de tri (ascendant ou descendant)
        example: desc
        in: query
        name: order
        required: false
        schema:
          enum:
          - asc
          - desc
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    items:
                      $ref: ../components/schemas/User.yaml
                    type: array
                  pagination:
                    properties:
                      limit:
                        example: 10
                        type: integer
                      page:
                        example: 1
                        type: integer
                      pages:
                        example: 15
                        type: integer
                      total:
                        example: 150
                        type: integer
                    type: object
                  success:
                    example: true
                    type: boolean
                type: object
          description: Liste des utilisateurs récupérée avec succès
        '400':
          $ref: ../components/responses/common.yaml#/BadRequest
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Lister tous les utilisateurs
      tags:
      - Users
  /users/export:
    get:
      description: 'Exporte la liste complète des utilisateurs au format CSV.

        Utile pour les rapports, analyses et sauvegardes.

        Seuls les administrateurs peuvent exporter les données.

        Le fichier inclut tous les champs utilisateurs sauf les mots de passe.

        '
      operationId: exportUsers
      parameters:
      - description: Filtrer l'export par rôle
        example: admin
        in: query
        name: role
        required: false
        schema:
          type: string
      responses:
        '200':
          content:
            text/csv:
              schema:
                type: string
          description: Fichier CSV généré avec succès
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '403':
          description: Seuls les administrateurs peuvent exporter
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Exporter les utilisateurs en CSV
      tags:
      - Users
  /users/profile:
    post:
      description: Create a new user account (Admin only)
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../components/schemas/UserRequest.yaml
        required: true
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: ../components/responses/SuccessResponse.yaml
                properties:
                  data:
                    $ref: ../components/schemas/User.yaml
          description: User created successfully
        '400':
          $ref: ../components/responses/BadRequest.yaml
        '401':
          $ref: ../components/responses/Unauthorized.yaml
        '403':
          $ref: ../components/responses/Forbidden.yaml
        '409':
          $ref: ../components/responses/Conflict.yaml
        '500':
          $ref: ../components/responses/ServerError.yaml
      security:
      - bearerAuth: []
      summary: Create a new user
      tags:
      - Users
    put:
      description: 'Met à jour le profil de l''utilisateur authentifié.

        Permet de modifier les informations personnelles et la photo de profil.

        La photo de profil doit être en format JPEG ou PNG (max 5MB).

        Seuls les utilisateurs vérifiés peuvent mettre à jour leur profil.

        '
      operationId: updateUserProfile
      requestBody:
        content:
          multipart/form-data:
            schema:
              properties:
                address:
                  description: Adresse complète
                  maxLength: 255
                  type: string
                city:
                  description: Ville
                  maxLength: 100
                  type: string
                country:
                  description: Pays
                  maxLength: 100
                  type: string
                firstName:
                  description: Prénom de l'utilisateur
                  maxLength: 50
                  minLength: 2
                  type: string
                lastName:
                  description: Nom de famille
                  maxLength: 50
                  minLength: 2
                  type: string
                phone:
                  description: Numéro de téléphone
                  pattern: ^[0-9+\-\s()]+$
                  type: string
                profile:
                  description: Image de profil (JPEG, PNG, max 5MB)
                  format: binary
                  type: string
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/User.yaml
                  message:
                    example: Profil mis à jour avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Profil mis à jour avec succès
        '400':
          $ref: ../components/responses/common.yaml#/BadRequest
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '403':
          description: Accès refusé ou utilisateur non vérifié
        '422':
          $ref: ../components/responses/common.yaml#/ValidationError
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Mettre à jour le profil utilisateur
      tags:
      - Users
  /users/search:
    get:
      description: 'Recherche avancée d''utilisateurs avec plusieurs critères de filtrage.

        Recherche par email, nom, prénom, rôle, statut.

        Retourne une liste paginée des résultats correspondants.

        '
      operationId: searchUsers
      parameters:
      - description: Terme de recherche principal (email, nom ou prénom)
        example: john@example.com
        in: query
        name: q
        required: true
        schema:
          minLength: 2
          type: string
      - $ref: ../components/parameters/common.yaml#/page
      - $ref: ../components/parameters/common.yaml#/limit
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    items:
                      $ref: ../components/schemas/User.yaml
                    type: array
                  pagination:
                    properties:
                      limit:
                        type: integer
                      page:
                        type: integer
                      pages:
                        type: integer
                      total:
                        type: integer
                    type: object
                  success:
                    example: true
                    type: boolean
                type: object
          description: Résultats de la recherche
        '400':
          $ref: ../components/responses/common.yaml#/BadRequest
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security: []
      summary: Rechercher des utilisateurs
      tags:
      - Users
  /users/{userId}:
    delete:
      description: 'Supprime logiquement un utilisateur (soft delete).

        L''utilisateur et ses données restent en base de données mais sont marqués
        comme supprimés.

        L''utilisateur ne peut plus se connecter mais ses données restent pour l''audit.

        Seuls les administrateurs peuvent effectuer cette action.

        '
      operationId: deleteUser
      parameters:
      - example: 550e8400-e29b-41d4-a716-446655440000
        in: path
        name: userId
        required: true
        schema:
          format: uuid
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  message:
                    example: Utilisateur supprimé avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Utilisateur supprimé avec succès
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '403':
          description: Seuls les administrateurs peuvent supprimer des utilisateurs
        '404':
          description: Utilisateur non trouvé
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Supprimer un utilisateur (suppression logique)
      tags:
      - Users
    get:
      description: 'Récupère les informations complètes d''un utilisateur spécifique
        par son ID.

        Inclut le profil complet, rôle, statut et dates importantes.

        '
      operationId: getUserById
      parameters:
      - description: ID unique de l'utilisateur (UUID)
        example: 550e8400-e29b-41d4-a716-446655440000
        in: path
        name: userId
        required: true
        schema:
          format: uuid
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/User.yaml
                  success:
                    example: true
                    type: boolean
                type: object
          description: Détails de l'utilisateur
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '404':
          description: Utilisateur non trouvé
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Récupérer les détails d'un utilisateur
      tags:
      - Users
    put:
      description: 'Met à jour les informations d''un utilisateur.

        Peut être appelé par l''utilisateur lui-même ou par un administrateur.

        Les champs sensibles (email, mot de passe) ne peuvent être modifiés que par
        l''utilisateur lui-même.

        '
      operationId: updateUser
      parameters:
      - example: 550e8400-e29b-41d4-a716-446655440000
        in: path
        name: userId
        required: true
        schema:
          format: uuid
          type: string
      requestBody:
        content:
          application/json:
            schema:
              properties:
                address:
                  type: string
                city:
                  type: string
                country:
                  type: string
                firstName:
                  type: string
                lastName:
                  type: string
                phone:
                  type: string
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/User.yaml
                  message:
                    example: Profil mis à jour avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Utilisateur mis à jour avec succès
        '400':
          $ref: ../components/responses/common.yaml#/BadRequest
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '403':
          description: Accès refusé - vous ne pouvez modifier que votre propre profil
        '404':
          description: Utilisateur non trouvé
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Mettre à jour un utilisateur
      tags:
      - Users
  /users/{userId}/restore:
    post:
      description: 'Restaure un utilisateur qui a été supprimé logiquement.

        Seuls les administrateurs peuvent restaurer des utilisateurs.

        L''utilisateur redevient actif et peut se connecter à nouveau.

        '
      operationId: restoreUser
      parameters:
      - example: 550e8400-e29b-41d4-a716-446655440000
        in: path
        name: userId
        required: true
        schema:
          format: uuid
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/User.yaml
                  message:
                    example: Utilisateur restauré avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Utilisateur restauré avec succès
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '403':
          description: Seuls les administrateurs peuvent restaurer des utilisateurs
        '404':
          description: Utilisateur non trouvé
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Restaurer un utilisateur supprimé
      tags:
      - Users
  /users/{userId}/role:
    put:
      description: 'Change le rôle d''un utilisateur (user, admin, moderator).

        Seuls les administrateurs peuvent effectuer cette action.

        Attention : cette action ne peut pas être annulée sans une autre modification.

        '
      operationId: updateUserRole
      parameters:
      - example: 550e8400-e29b-41d4-a716-446655440000
        in: path
        name: userId
        required: true
        schema:
          format: uuid
          type: string
      requestBody:
        content:
          application/json:
            schema:
              properties:
                role:
                  description: Nouveau rôle de l'utilisateur
                  enum:
                  - user
                  - admin
                  - moderator
                  example: admin
                  type: string
              required:
              - role
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  data:
                    $ref: ../components/schemas/User.yaml
                  message:
                    example: Rôle utilisateur mis à jour avec succès
                    type: string
                  success:
                    example: true
                    type: boolean
                type: object
          description: Rôle utilisateur mis à jour avec succès
        '400':
          $ref: ../components/responses/common.yaml#/BadRequest
        '401':
          $ref: ../components/responses/common.yaml#/Unauthorized
        '403':
          description: Seuls les administrateurs peuvent modifier les rôles
        '404':
          description: Utilisateur non trouvé
        '500':
          $ref: ../components/responses/common.yaml#/ServerError
      security:
      - bearerAuth: []
      summary: Modifier le rôle d'un utilisateur
      tags:
      - Users
servers:
- description: Environnement de développement local
  url: http://localhost:3000
- description: Environnement de staging
  url: https://api.staging.azefarm.com
- description: Production
  url: https://api.azefarm.com
tags:
- description: Product search and management with geolocation
  name: Products
- description: User authentication and account management
  name: Authentication
- description: User profile management
  name: Users
- description: Third-party authentication (Google, Apple, etc.)
  name: OAuth
