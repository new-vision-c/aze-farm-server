services:
  # Service Web principal
  - type: web
    name: aze-farm-api
    env: node
    plan: free
    autoDeploy: true
    repo: https://github.com/new-vision-c/aze-farm-server.git
    envVars:
      # Configuration de l'application
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: APP_NAME
        value: Aze Farm API
      - key: DB_TYPE
        value: mongodb
      - key: APP_DESCRIPTION
        value: 'Full backend architecture'
      - key: APP_AUTHOR
        value: 'Xenos MH'
      - key: APP_VERSION
        value: 1.0.0
      - key: APP_LICENSE
        value: MIT
      - key: DEFAULT_API_PREFIX
        value: /api/v1
      - key: RATE_LIMIT_WINDOW_MS
        value: 900000
      - key: RATE_LIMIT_MAX_REQUESTS
        value: 100
      - key: DISABLE_CONSOLE_LOGS
        value: true

      # Base de données MongoDB Atlas (URI cloud avec paramètres SSL/TLS)
      - key: DATABASE_URL
        value: mongodb+srv://cesaristos5:50VPTVyd82Y2wmPF@environementtestnvc.a21hzv7.mongodb.net/aze-farm-test?retryWrites=true&w=majority&authSource=admin&tls=true&tlsAllowInvalidCertificates=true&serverSelectionTimeoutMS=5000&connectTimeoutMS=10000
        sync: true
      - key: MONGO_URL
        value: mongodb+srv://cesaristos5:50VPTVyd82Y2wmPF@environementtestnvc.a21hzv7.mongodb.net/?retryWrites=true&w=majority&authSource=admin&tls=true&tlsAllowInvalidCertificates=true&serverSelectionTimeoutMS=5000&connectTimeoutMS=10000
        sync: true
      - key: MONGO_USER
        value: cesaristos5
      - key: MONGO_PASSWORD
        value: 50VPTVyd82Y2wmPF
      - key: MONGO_DB
        value: aze-farm-test
      - key: MONGO_PORT
        value: 27017

      - key: CORS_ORIGIN
        value: '*'

      # Configuration Redis
      - key: REDIS_URL
        fromService:
          type: redis
          name: aze-farm-redis
          property: connectionString
      - key: REDIS_PASSWORD
        value: ''
      - key: REDIS_DB
        value: 0
      - key: REDIS_PREFIX
        value: aze-farm
      - key: REDIS_NAME
        value: BACKEND_CACHE
      - key: REDISINSIGHT_NAME
        value: REDISINSIGHT
      - key: REDISINSIGHT_PORT
        value: 8002

      # JWT
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: 14d

      # Cache
      - key: CACHE_DEFAULT_TTL
        value: 3600
      - key: CACHE_DISABLED
        value: false
      - key: REDIS_HOST
        fromService:
          type: redis
          name: aze-farm-redis
          property: host
      - key: REDIS_PORT
        fromService:
          type: redis
          name: aze-farm-redis
          property: port

      # Logs
      - key: LOG_LEVEL
        value: info
      - key: LOG_FILE_ENABLED
        value: false
      - key: LOG_FILE_PATH
        value: logs/app.log
      - key: LOG_FILE_MAX_SIZE
        value: 100m
      - key: LOG_FILE_MAX_FILES
        value: 14d

      # Configuration supplémentaire pour le farming
      - key: FARM_API_KEY
        generateValue: true
      - key: FARM_WEBHOOK_SECRET
        generateValue: true
      - key: MAX_CONCURRENT_TASKS
        value: 10
      - key: TASK_TIMEOUT
        value: 300

      # Monitoring
      - key: METRICS_ENABLED
        value: true
      - key: HEALTH_CHECK_INTERVAL
        value: 30

      # Service Mail (Gmail SMTP)
      - key: SMTP_USER
        value: "cesaristos85@gmail.com"
      - key: SMTP_PASS
        value: "ybfm tkhc pyaa bmuy"

      # Configuration MinIO (à configurer avec un service cloud si nécessaire)
      # Désactivé pour Render - utiliser Cloudinary ou S3 en production
      - key: MINIO_ENABLED
        value: false
      - key: MINIO_ACCESS_KEY
        value: minioadmin
      - key: MINIO_SECRET_KEY
        value: minio123
      - key: MINIO_PORT
        value: 9000
      - key: MINIO_ENDPOINT
        value: localhost
      - key: MINIO_APP_BUCKET
        value: gta
      - key: MINIO_BASE_PATH
        value: uploads/
      - key: MINIO_USE_SSL
        value: false

      # Configuration ClamAV (à configurer avec un service cloud si nécessaire)
      # Désactivé pour Render
      - key: CLAMAV_ENABLED
        value: false
      - key: CLAMAV_HOST
        value: clamav
      - key: CLAMAV_PORT
        value: 3310
      - key: CLAMAV_TIMEOUT
        value: 20000

  # Service Redis
  - type: redis
    name: aze-farm-redis
    plan: free
    ipAllowList: [] # Autoriser uniquement les services Render
